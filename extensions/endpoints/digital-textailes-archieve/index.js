"use strict";const e={".ico":"image/x-icon",".css":"text/css",".js":"application/javascript",".download":"application/javascript",".png":"image/png",".jpg":"image/jpeg",".jpeg":"image/jpeg",".svg":"image/svg+xml",".gif":"image/gif",".woff":"font/woff",".woff2":"font/woff2",".ttf":"font/ttf",".eot":"application/vnd.ms-fontobject"},t="/directus/extensions/endpoints/digital-textailes-archieve/static/Archieve_files",s="/directus/uploads",i="Icon-Textailes-Colour-RGB-Ver.png";module.exports=(n,{services:a})=>{const{ItemsService:l}=a,c=require("fs"),o=require("path"),r=(t,s,i=null)=>{if(!c.existsSync(t))return s.status(404).send("File not found");const n=o.extname(t).toLowerCase(),a=i||e[n];a&&s.set("Content-Type",a);const l=c.readFileSync(t);s.send(l)};n.get("/static/Archieve_files/*",(e,s)=>{const i=e.params[0],n=o.join(t,i);r(n,s)}),n.get("/favicon.ico",(e,s)=>{const n=o.join(t,i);r(n,s,"image/png")}),n.get("/assets/:fileId",async(e,t)=>{try{const i=new l("directus_files",{schema:e.schema,accountability:null}),n=await i.readOne(e.params.fileId);if(!n)return t.status(404).send("File not found");const a=o.join(s,n.filename_disk);if(!c.existsSync(a))return t.status(404).send("File not found on disk");if(t.set("Content-Type",n.type||"application/octet-stream"),t.set("Access-Control-Allow-Origin","*"),"model/gltf+json"===n.type||n.filename_download.endsWith(".gltf")){const e=c.readFileSync(a,"utf8"),s=JSON.parse(e);return await(async(e,t)=>{const s=await t.readByQuery({fields:["id","filename_download"],limit:-1}),i=new Map(s.map(e=>[e.filename_download,e.id])),n=e=>{if(e.uri&&!e.uri.startsWith("data:")){const t=o.basename(e.uri),s=i.get(t);s&&(e.uri=s)}};return e.buffers?.forEach(n),e.images?.forEach(n),e})(s,i),t.set("Content-Type","model/gltf+json"),t.send(JSON.stringify(s))}c.createReadStream(a).pipe(t)}catch(e){console.error("Asset error:",e),t.status(500).send("Error: "+e.message)}}),n.get("/",async(e,t)=>{const s=new l("costumes",{schema:e.schema,accountability:null});try{const e=(await s.readByQuery({fields:["id","title","gltf_file","creator","sensor","location","source","time_period"],filter:{id:{_eq:1}}}))[0]||{},i=`<!DOCTYPE html>\n<html lang="en" dir="ltr" data-bs-theme="light">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">\n    <title>Digital Textailes Archive</title>\n    \n    \x3c!-- Favicon with cache busting --\x3e\n    <link rel="icon" type="image/png" href="/digital-textailes-archieve/static/Archieve_files/Icon-Textailes-Colour-RGB-Ver.png">\n    \n\t\x3c!-- Bootstrap CSS --\x3e\n    <link type="text/css" href="/digital-textailes-archieve/static/Archieve_files/bootstrap.css" rel="stylesheet">\n    \n    \x3c!-- Fontawesome --\x3e\n    <link type="text/css" href="/digital-textailes-archieve/static/Archieve_files/all.css" rel="stylesheet">\n    \n    \x3c!-- Custom CSS --\x3e\n    <link type="text/css" href="/digital-textailes-archieve/static/Archieve_files/style.css" rel="stylesheet">\n    \n    \x3c!-- Model Viewer --\x3e\n    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"><\/script>\n</head>\n\n<body id="costume" tabindex="0">\n\n<nav id="menu" class="ntnavbar navbar-expand-lg" aria-label="navbar">\n    <div class="container">\n        <div class="row mt-1">\n            <div class="col-md-2 col-sm-12">\n                <a class="navbar-brand" href="https://textailes-eccch.eu/">\n                    <img src="/digital-textailes-archieve/static/Archieve_files/Logo-Textailes_Logo-Textailes-Colour-RGB-Hor.svg" alt="Logo" style="margin-top: 10%;">\n                </a>\n            </div>\n            <div class="col-md-10 col-sm-12 text-end">\n                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">\n                    <span class="navbar-toggler-icon"><i class="fas fa-bars"></i></span>\n                </button>\n                <div class="collapse navbar-collapse horizontal_border" id="navbarMenu">\n                    <ul class="navbar-nav me-auto mb-2 mb-lg-0 nt_mtop text-uppercase">\n                        <li class="nav-item">\n                            <a class="firstnav nav-link py-1" href="/digital-textailes-archieve">Artifacts</a>\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n    </div>\n</nav>\n\n<div class="container mb-5">\n    <div class="row mt-3">\n        <div class="col-0 col-lg-2"></div>\n        <div class="col-12 col-lg-10">\n            <nav aria-label="breadcrumb">\n                <ol class="breadcrumb">\n                    <li class="breadcrumb-item"><a href="https://textailes-eccch.eu/">Home</a></li>\n                    <li class="breadcrumb-item active" aria-current="page">\n                        <span class="breadCurrent">${e.title||"Artifact"}</span>\n                    </li>\n                </ol>\n            </nav>\n        </div>\n    </div>\n\n    <div class="row">\n        <div class="col-0 col-lg-2"></div>\n        <div class="col-12 col-lg-10">\n            <div class="mt-5 mb-5">\n                <div id="costume-model" style="height: 555px;">\n                    <model-viewer \n                        src="/digital-textailes-archieve/assets/${e.gltf_file}"\n                        alt="${e.title||"3D Costume Model"}"\n                        camera-controls \n                        auto-rotate\n                        shadow-intensity="1"\n                        style="width: 100%; height: 100%;">\n                    </model-viewer>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="row mt-5">\n        <div class="col-lg-2 col-sm-0 col-md-0"></div>\n        <div class="col-lg-5 col-sm-12 col-md-12 mb-2">\n            <dl>\n                <dt class="samewidth">Title:</dt>\n                <dd>${e.title||"N/A"}</dd>\n                \n                <dt class="samewidth">Creator:</dt>\n                <dd>${e.creator||"N/A"}</dd>\n                \n                <dt class="samewidth">ID:</dt>\n                <dd>${e.id||"N/A"}</dd>\n            </dl>\n        </div>\n        <div class="col-lg-5 col-sm-12 col-md-12 mb-2">\n            <dl>\n                <dt class="samewidth">Time Period:</dt>\n                <dd>${e.time_period||"N/A"}</dd>\n                \n                <dt class="samewidth">Sensor:</dt>\n                <dd>${e.sensor||"N/A"}</dd>\n                \n                <dt>Location:</dt>\n                <dd>${e.location||"N/A"}</dd>\n                \n                <dt>Source:</dt>\n                <dd>${e.source||"N/A"}</dd>\n            </dl>\n        </div>\n    </div>\n</div>\n\n<footer class="footer mt-auto">\n    <div class="dark-footer h-75">\n        <div class="container py-4">\n            <div class="row dark-footer">\n                <div class="col-lg-4 col-md-4 col-sm-12 vertical-line-right text-lg-start text-sm-center py-2">\n                    <p class="pt-4">\n                        <a href="https://textailes-eccch.eu/">\n                            <img src="/digital-textailes-archieve/static/Archieve_files/EN_FundedbytheEU_RGB_NEG-1024x228.png" style="max-width: 350px;">\n                        </a>\n                    </p>\n\t\t\t\t\t<div class="footerLink pt-1">\n                        <p>TEXTaiLES is a project funded by the European Commission under Grant Agreement n.101158328. The views and opinions expressed in this website are the sole responsibility of the author and do not necessarily reflect the views of the European Commission.</p>\n                        <p><small><br>\n                        <br>\n                        <br>\n                        <a class="plainlink" href="mailto:archive@n-t.gr" title="contact us" alt="contact mail"></a></small></p>                     </div>\n                </div>\n                <div class="col-lg-4 col-md-4 col-sm-12 vertical-line-right text-lg-start text-sm-center pt-4">\n                    <p class="pt-4">\n                        <a href="https://textailes-eccch.eu/">\n                            <img src="/digital-textailes-archieve/static/Archieve_files/ECHOES_Logo_White_Horizontal_300x300-1024x221.png" style="max-width: 300px;">\n                        </a>\n                    </p>\n\t\t\t\t\t<p>TEXTaiLES is part of the ECCCH initiative.</p>\n                </div>\n                <div class="col-lg-4 col-md-4 col-sm-12 text-lg-start text-sm-center pt-4">\n                    <p class="pt-4">\n                        <a href="https://textailes-eccch.eu/">\n                            <img src="/digital-textailes-archieve/static/Archieve_files/WBF_SBFI_EU_Frameworkprogramme_E_RGB_neg_hoch.png" style="max-width: 350px;">\n                        </a>\n                    </p>\n                </div>\n            </div>\n        </div>\n    </div>\n</footer>\n\n<script src="/digital-textailes-archieve/static/Archieve_files/jquery-3.6.0.min.js.download"><\/script>\n<script src="/digital-textailes-archieve/static/Archieve_files/bootstrap.bundle.min.js.download"><\/script>\n\n</body>\n</html>`;t.set("Content-Type","text/html"),t.set("Content-Security-Policy","default-src 'self'; script-src 'self' 'unsafe-eval' https://ajax.googleapis.com; script-src-elem 'self' https://ajax.googleapis.com; connect-src 'self' https://ajax.googleapis.com https://www.gstatic.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; worker-src 'self' blob:; child-src 'self' blob:;"),t.send(i)}catch(e){t.status(500).send("Error: "+e.message)}})};
